#+title: Flatpak: Linux Application Sandboxing Deep Dive
#+author: SOV710
#+date: 2025-12-29
#+startup: showall
#+options: toc:2 num:nil

* Flatpak æ˜¯ä»€ä¹ˆ: Linux è½¯ä»¶åˆ†å‘çš„ç°ä»£è§£æ³•

Flatpak æ˜¯ä¸€ä¸ª *åº”ç”¨æ²™ç®±* å’Œ *è½¯ä»¶åˆ†å‘* ç³»ç»Ÿï¼Œç›®æ ‡æ˜¯è§£å†³ Linux æ¡Œé¢åº”ç”¨çš„å‡ ä¸ªè€å¤§éš¾é—®é¢˜:

- *ä¾èµ–åœ°ç‹±*: ä¸åŒå‘è¡Œç‰ˆçš„åº“ç‰ˆæœ¬ä¸åŒï¼Œåº”ç”¨æ‰“åŒ…è€…è¦ç»´æŠ¤æ— æ•°ä¸ªåŒ…
- *ç³»ç»Ÿæ±¡æŸ“*: åº”ç”¨å®‰è£…åˆ° =/usr= ä¸‹ï¼Œå¸è½½ä¸å¹²å‡€
- *æƒé™å¤±æ§*: æ‰€æœ‰åº”ç”¨éƒ½èƒ½è®¿é—® =$HOME= çš„æ‰€æœ‰æ–‡ä»¶
- *æ›´æ–°æ»å*: å‘è¡Œç‰ˆä»“åº“çš„è½¯ä»¶ç‰ˆæœ¬å¾€å¾€è½åä¸Šæ¸¸å‡ ä¸ªæœˆç”šè‡³å‡ å¹´

Flatpak é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³:

1. *åº”ç”¨è‡ªå¸¦ä¾èµ–*: æ¯ä¸ª Flatpak åº”ç”¨æ‰“åŒ…äº†è‡ªå·±çš„åº“ï¼Œä¸ä¾èµ–ç³»ç»Ÿåº“
2. *æ²™ç®±éš”ç¦»*: åº”ç”¨è¿è¡Œåœ¨å—é™ç¯å¢ƒä¸­ï¼Œé»˜è®¤æ— æ³•è®¿é—®ç³»ç»Ÿæ–‡ä»¶
3. *ç»Ÿä¸€åˆ†å‘*: Flathub æä¾›ä¸­å¿ƒåŒ–çš„åº”ç”¨å•†åº—ï¼Œå¼€å‘è€…ä¸Šä¼ ä¸€æ¬¡ï¼Œæ‰€æœ‰å‘è¡Œç‰ˆéƒ½èƒ½ç”¨
4. *å¿«é€Ÿæ›´æ–°*: ç»•è¿‡å‘è¡Œç‰ˆçš„æ‰“åŒ…æµç¨‹ï¼Œä¸Šæ¸¸å‘å¸ƒåå‡ å¤©å†…å°±èƒ½æ›´æ–°

** Flatpak vs. Snap vs. AppImage

| ç‰¹æ€§         | Flatpak                  | Snap                   | AppImage              |
|--------------+--------------------------+------------------------+-----------------------|
| å‘èµ·è€…        | Red Hat / Endless OS     | Canonical (Ubuntu)     | ç¤¾åŒº                  |
| éš”ç¦»æœºåˆ¶      | Bubblewrap + namespaces  | AppArmor + namespaces  | *æ— * (FUSE æŒ‚è½½)         |
| å»ä¸­å¿ƒåŒ–      | æ”¯æŒå¤šä»“åº“                 | ä»… Canonical å®˜æ–¹å•†åº—    | å®Œå…¨å»ä¸­å¿ƒåŒ–            |
| Runtime å…±äº« | æ˜¯ (å¤šåº”ç”¨å…±äº«åŸºç¡€ Runtime) | å¦ (æ¯ä¸ª Snap ç‹¬ç«‹)      | å¦ (æ¯ä¸ª AppImage ç‹¬ç«‹) |
| åå°æœåŠ¡      | å¦                       | æ˜¯ (=systemd= é›†æˆ)       | å¦                    |
| å¯åŠ¨é€Ÿåº¦      | å¿« (~100ms)              | æ…¢ (~2-5s, loop mount) | æœ€å¿« (~50ms)          |
| ç£ç›˜å ç”¨      | ä¸­ (Runtime å…±äº«)         | å¤§ (æ— å…±äº«)             | å¤§ (æ— å…±äº«)            |
| æ¡Œé¢é›†æˆ      | å¥½                       | ä¸­                     | å·®                    |
| ä¸»æµåº¦        | GNOME/KDE å®˜æ–¹æ”¯æŒ        | Ubuntu é»˜è®¤            | å°ä¼—                  |

*ä¸ªäººè§‚ç‚¹*: Flatpak æ˜¯ç›®å‰æœ€æˆç†Ÿçš„æ–¹æ¡ˆï¼Œç¤¾åŒºæ”¯æŒæœ€å¹¿ã€‚Snap è¢« Canonical ç»‘æ¶ï¼Œé—­æºåç«¯ä»¤äººæ¶å¿ƒã€‚AppImage é€‚åˆä¾¿æºå¼åº”ç”¨ï¼Œä½†ç¼ºä¹æ²™ç®±ã€‚

* åº•å±‚æŠ€æœ¯åŸç†: Linux Namespaces + Bubblewrap

Flatpak çš„æ ¸å¿ƒæ˜¯ *Bubblewrap* (=bwrap=)ï¼Œä¸€ä¸ªè½»é‡çº§çš„æ²™ç®±å·¥å…·ã€‚

** Linux Namespaces: éš”ç¦»çš„åŸºç¡€

Linux namespaces æä¾›äº† 7 ç§èµ„æºéš”ç¦»æœºåˆ¶:

| Namespace | éš”ç¦»å†…å®¹           | ç”¨é€”                     |
|-----------+-------------------+--------------------------|
| =mnt=       | æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹       | éš”ç¦» =/proc=, =/sys=, =/tmp=   |
| =pid=       | è¿›ç¨‹ ID           | åº”ç”¨çœ‹ä¸åˆ°å®¿ä¸»æœºçš„å…¶ä»–è¿›ç¨‹    |
| =net=       | ç½‘ç»œæ ˆ             | ç½‘ç»œéš”ç¦» (Flatpak é»˜è®¤ä¸ç”¨) |
| =uts=       | ä¸»æœºåå’ŒåŸŸå        | ä¿®æ”¹ä¸»æœºåä¸å½±å“å®¿ä¸»æœº       |
| =ipc=       | System V IPC å¯¹è±¡ | éš”ç¦»å…±äº«å†…å­˜ã€ä¿¡å·é‡         |
| =user=      | ç”¨æˆ·/ç»„ ID æ˜ å°„     | é root ç”¨æˆ·åˆ›å»ºæ²™ç®±        |
| =cgroup=    | cgroup æ ¹ç›®å½•      | èµ„æºé™åˆ¶                  |

Flatpak ä¸»è¦ä½¿ç”¨ =mnt=, =pid=, =ipc=, =user= è¿™ 4 ä¸ªã€‚

** Bubblewrap: æ¯” Docker æ›´è½»é‡çš„æ²™ç®±

Bubblewrap æ˜¯ä¸€ä¸ª setuid ç¨‹åº (æˆ–ä½¿ç”¨ =user= namespace)ï¼Œç”¨äºåˆ›å»ºå—é™çš„æ‰§è¡Œç¯å¢ƒã€‚

*** åŸºæœ¬ç”¨æ³•

#+begin_src bash
# æœ€ç®€å•çš„æ²™ç®±: éš”ç¦»æ–‡ä»¶ç³»ç»Ÿ
bwrap \
  --ro-bind /usr /usr \         # åªè¯»æŒ‚è½½ /usr
  --ro-bind /lib /lib \
  --ro-bind /lib64 /lib64 \
  --proc /proc \                # æŒ‚è½½æ–°çš„ /proc
  --dev /dev \                  # æŒ‚è½½æ–°çš„ /dev
  --tmpfs /tmp \                # ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ
  --unshare-all \               # éš”ç¦»æ‰€æœ‰ namespace (é™¤äº† net)
  --share-net \                 # å…±äº«ç½‘ç»œ
  --new-session \               # æ–°çš„ä¼šè¯ ID
  /bin/bash                     # åœ¨æ²™ç®±ä¸­è¿è¡Œ bash
#+end_src

è¿›å…¥æ²™ç®±å:

#+begin_src bash
$ ls /
usr  lib  lib64  proc  dev  tmp

$ ls /home
ls: cannot access '/home': No such file or directory

$ ps aux
# åªèƒ½çœ‹åˆ°æ²™ç®±å†…çš„è¿›ç¨‹
#+end_src

*** Flatpak çš„ Bubblewrap é…ç½®

å®é™…è¿è¡Œ Flatpak åº”ç”¨æ—¶ï¼Œâ€‹=bwrap= å‚æ•°éå¸¸å¤æ‚:

#+begin_src bash
$ ps aux | grep bwrap
/usr/bin/bwrap \
  --args 59 \  # ä» fd 59 è¯»å–æ›´å¤šå‚æ•° (å‚æ•°å¤ªé•¿)
  /app/bin/firefox
#+end_src

æŸ¥çœ‹å®Œæ•´å‚æ•°:

#+begin_src bash
$ flatpak run --command=sh org.mozilla.firefox
sh-5.2$ cat /proc/$$/cmdline | tr '\0' '\n' | head -50
/usr/bin/bwrap
--args
59
--ro-bind
/usr
/usr
--ro-bind
/etc
/etc
--bind
/run/user/1000/app/org.mozilla.firefox
/run/user/1000/app/org.mozilla.firefox
--tmpfs
/tmp
--proc
/proc
--dev
/dev
...
#+end_src

å…³é”®æŒ‚è½½ç‚¹:

- =--ro-bind /usr /usr=: Runtime çš„ =/usr= åªè¯»æŒ‚è½½
- =--bind $HOME/.var/app/... $HOME=: åº”ç”¨çš„ç§æœ‰æ•°æ®ç›®å½•
- =--bind /run/user/1000/... /run/user/1000/...=: XDG Runtime ç›®å½• (socket, portal)
- =--tmpfs /tmp=: ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿï¼Œè¿›ç¨‹é€€å‡ºå³æ¸…ç©º
- =--proc /proc=: éš”ç¦»çš„ =/proc=ï¼Œåªèƒ½çœ‹åˆ°æ²™ç®±å†…çš„è¿›ç¨‹

** OSTree: é«˜æ•ˆçš„æ–‡ä»¶ç³»ç»Ÿå¿«ç…§

Flatpak ä½¿ç”¨ *OSTree* æ¥ç®¡ç† Runtime å’Œåº”ç”¨çš„æ–‡ä»¶ã€‚

*** OSTree æ˜¯ä»€ä¹ˆ

OSTree æ˜¯ä¸€ä¸ª *å†…å®¹å¯»å€* çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒç®¡ç†å·¥å…·ï¼Œç±»ä¼¼ Git ä½†ç”¨äºæ–‡ä»¶ç³»ç»Ÿ:

- æ¯ä¸ªæ–‡ä»¶é€šè¿‡ SHA256 å“ˆå¸Œæ ‡è¯†
- ç›¸åŒå†…å®¹çš„æ–‡ä»¶åªå­˜å‚¨ä¸€æ¬¡ (å»é‡)
- é€šè¿‡ç¡¬é“¾æ¥å…±äº«ä¸å˜çš„æ–‡ä»¶
- åŸå­æ›´æ–°: è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š

*** Flatpak çš„å­˜å‚¨å¸ƒå±€

Flatpak çš„æ‰€æœ‰æ•°æ®å­˜åœ¨ =/var/lib/flatpak= (ç³»ç»Ÿçº§) æˆ– =$HOME/.local/share/flatpak= (ç”¨æˆ·çº§):

#+begin_example
/var/lib/flatpak/
â”œâ”€â”€ app/                    # å·²å®‰è£…çš„åº”ç”¨
â”‚   â””â”€â”€ org.mozilla.firefox/
â”‚       â””â”€â”€ x86_64/
â”‚           â””â”€â”€ stable/
â”‚               â””â”€â”€ active  # æŒ‡å‘å½“å‰ç‰ˆæœ¬çš„ commit
â”œâ”€â”€ runtime/                # å·²å®‰è£…çš„ Runtime
â”‚   â””â”€â”€ org.freedesktop.Platform/
â”‚       â””â”€â”€ x86_64/
â”‚           â””â”€â”€ 23.08/
â”‚               â””â”€â”€ active
â”œâ”€â”€ repo/                   # OSTree ä»“åº“ (å¯¹è±¡å­˜å‚¨)
â”‚   â”œâ”€â”€ objects/            # å®é™…çš„æ–‡ä»¶å†…å®¹ (æŒ‰ SHA256 å­˜å‚¨)
â”‚   â”‚   â”œâ”€â”€ 00/
â”‚   â”‚   â”‚   â””â”€â”€ 1234abcd...
â”‚   â”‚   â””â”€â”€ ff/
â”‚   â”‚       â””â”€â”€ fedcba98...
â”‚   â””â”€â”€ refs/               # å¼•ç”¨ (æŒ‡å‘ commit)
â”‚       â””â”€â”€ heads/
â”‚           â””â”€â”€ app/org.mozilla.firefox/x86_64/stable
â””â”€â”€ exports/                # å¯¼å‡ºçš„æ¡Œé¢æ–‡ä»¶ã€å›¾æ ‡ç­‰
    â””â”€â”€ share/
        â”œâ”€â”€ applications/
        â”‚   â””â”€â”€ org.mozilla.firefox.desktop
        â””â”€â”€ icons/
#+end_example

*** å»é‡æœºåˆ¶

å‡è®¾å®‰è£…äº† Firefox å’Œ Thunderbirdï¼Œå®ƒä»¬éƒ½ä¾èµ– =org.freedesktop.Platform= Runtime:

#+begin_example
Runtime ä¸­çš„ /usr/lib/libgtk-3.so.0
â†’ SHA256: abcd1234...
â†’ åœ¨ repo/objects/ab/cd1234... å­˜å‚¨ä¸€æ¬¡

Firefox å’Œ Thunderbird éƒ½é€šè¿‡ç¡¬é“¾æ¥æŒ‡å‘åŒä¸€æ–‡ä»¶
â†’ ç£ç›˜å ç”¨ ~= 1 ä»½
#+end_example

æŸ¥çœ‹ç¡¬é“¾æ¥æ•°:

#+begin_src bash
$ ls -li /var/lib/flatpak/runtime/org.freedesktop.Platform/x86_64/23.08/active/files/lib/libgtk-3.so.0
123456 -rwxr-xr-x 5 root root 4567890 Jan 1 00:00 libgtk-3.so.0
#                 ^ ç¡¬é“¾æ¥æ•° = 5
#+end_src

** User Namespace: æ— ç‰¹æƒæ²™ç®±

ä¼ ç»Ÿçš„æ²™ç®±å·¥å…· (å¦‚ =chroot=, =unshare=) éœ€è¦ root æƒé™ã€‚Flatpak é€šè¿‡ *User Namespace* å®ç° *éç‰¹æƒæ²™ç®±*â€‹ã€‚

*** UID/GID æ˜ å°„

User namespace å…è®¸è¿›ç¨‹åœ¨ namespace å†…æ‹¥æœ‰ root æƒé™ï¼Œä½†åœ¨å®¿ä¸»æœºä¸Šæ˜¯æ™®é€šç”¨æˆ·:

#+begin_src bash
$ id
uid=1000(sov710) gid=1000(sov710)

$ unshare --user --map-root-user /bin/bash
# id
uid=0(root) gid=0(root)  # åœ¨ namespace å†…æ˜¯ root

# ä½†æ— æ³•è®¿é—®å®¿ä¸»æœºçš„ /root
# ls /root
ls: cannot open directory '/root': Permission denied
#+end_src

Flatpak åˆ©ç”¨è¿™ä¸ªæœºåˆ¶ï¼Œè®©åº”ç”¨åœ¨æ²™ç®±å†…ä»¥ "root" èº«ä»½è¿è¡Œ (å®é™…ä¸Šæ˜¯æ˜ å°„çš„ UID)ï¼Œä½†æ— æ³•ææƒåˆ°çœŸæ­£çš„ rootã€‚

*** æ£€æŸ¥æ˜¯å¦æ”¯æŒ User Namespace

#+begin_src bash
$ unshare --user --pid --fork --mount-proc /bin/true && echo "æ”¯æŒ" || echo "ä¸æ”¯æŒ"
#+end_src

å¦‚æœå†…æ ¸ç¦ç”¨äº† =user_namespaces= (æŸäº›å‘è¡Œç‰ˆé»˜è®¤ç¦ç”¨):

#+begin_src bash
$ sysctl kernel.unprivileged_userns_clone
kernel.unprivileged_userns_clone = 0  # ç¦ç”¨

# å¯ç”¨ (éœ€è¦ root)
$ sudo sysctl -w kernel.unprivileged_userns_clone=1
#+end_src

* Runtime å’Œ SDK: åº”ç”¨çš„ "æ“ä½œç³»ç»Ÿ"

** Runtime: åº”ç”¨çš„è¿è¡Œæ—¶ç¯å¢ƒ

Runtime æ˜¯åº”ç”¨è¿è¡Œæ‰€éœ€çš„ *åŸºç¡€åº“* é›†åˆï¼Œç±»ä¼¼ä¸€ä¸ªæœ€å°åŒ–çš„ Linux å‘è¡Œç‰ˆã€‚

*** ä¸»æµ Runtime

| Runtime                          | ç»´æŠ¤è€…       | å†…å®¹                              | ç”¨é€”               |
|----------------------------------+-------------+-----------------------------------+--------------------|
| =org.freedesktop.Platform=         | Freedesktop | glibc, GTK 3, Qt 5, Mesa, ...     | é€šç”¨åº”ç”¨            |
| =org.gnome.Platform=               | GNOME       | GNOME åº“ (GTK 4, libadwaita, ...) | GNOME åº”ç”¨         |
| =org.kde.Platform=                 | KDE         | Qt 6, KDE Frameworks 6            | KDE åº”ç”¨           |
| =org.freedesktop.Platform.GL=      | Freedesktop | æ˜¾å¡é©±åŠ¨ (Mesa, NVIDIA)            | éœ€è¦ OpenGL/Vulkan |
| =com.valvesoftware.Steam.Platform= | Valve       | Steam Runtime                     | Steam æ¸¸æˆ         |

*** Runtime ç‰ˆæœ¬

Runtime æœ‰å¤šä¸ª *åˆ†æ”¯*â€‹ï¼Œå¯¹åº”ä¸åŒç‰ˆæœ¬:

#+begin_src bash
$ flatpak list --runtime
Name                          Application ID                     Version  Branch
Freedesktop Platform          org.freedesktop.Platform           23.08.19 23.08
Freedesktop Platform          org.freedesktop.Platform           24.08.2  24.08
GNOME Application Platform    org.gnome.Platform                 46       46
Mesa                          org.freedesktop.Platform.GL.default 24.1.7  23.08
#+end_src

åº”ç”¨å£°æ˜ä¾èµ–çš„ Runtime ç‰ˆæœ¬:

#+begin_src bash
$ flatpak info org.mozilla.firefox | grep Runtime
Runtime: org.freedesktop.Platform/x86_64/23.08
#+end_src

*** Runtime çš„å†…å®¹

Runtime å®é™…ä¸Šæ˜¯ä¸€ä¸ª =/usr= ç›®å½•æ ‘:

#+begin_src bash
$ ls /var/lib/flatpak/runtime/org.freedesktop.Platform/x86_64/23.08/active/files/
bin  etc  lib  lib64  libexec  share  usr
#+end_src

æŒ‚è½½åˆ°æ²™ç®±å:

#+begin_src bash
$ flatpak run --command=bash org.mozilla.firefox
[ğŸ“¦ org.mozilla.firefox ~]$ ls /usr
bin  etc  lib  lib64  libexec  share  # æ¥è‡ª Runtime

[ğŸ“¦ org.mozilla.firefox ~]$ ldd /app/bin/firefox
linux-vdso.so.1
libpthread.so.0 => /usr/lib/libpthread.so.0  # æ¥è‡ª Runtime
libc.so.6 => /usr/lib/libc.so.6              # æ¥è‡ª Runtime
...
#+end_src

** SDK: æ„å»ºåº”ç”¨çš„å¼€å‘ç¯å¢ƒ

SDK (Software Development Kit) æ˜¯å¯¹åº” Runtime çš„ *å¼€å‘å·¥å…·é›†*â€‹ï¼ŒåŒ…å«ç¼–è¯‘å™¨ã€å¤´æ–‡ä»¶ã€è°ƒè¯•å·¥å…·ç­‰ã€‚

| Runtime                   | SDK                          |
|---------------------------+------------------------------|
| =org.freedesktop.Platform=  | =org.freedesktop.Sdk=          |
| =org.gnome.Platform=        | =org.gnome.Sdk=                |
| =org.kde.Platform=          | =org.kde.Sdk=                  |

SDK åªåœ¨ *æ„å»º* æ—¶ä½¿ç”¨ï¼Œä¸ä¼šè¢«æ‰“åŒ…åˆ°æœ€ç»ˆçš„ Flatpak åº”ç”¨ä¸­ã€‚

*** å®‰è£… SDK

#+begin_src bash
$ flatpak install flathub org.freedesktop.Sdk//23.08
#+end_src

*** è¿›å…¥ SDK ç¯å¢ƒ

#+begin_src bash
$ flatpak run --command=bash org.freedesktop.Sdk//23.08
[ğŸ“¦ org.freedesktop.Sdk ~]$ gcc --version
gcc (GCC) 13.2.0

[ğŸ“¦ org.freedesktop.Sdk ~]$ which pkg-config
/usr/bin/pkg-config
#+end_src

è¿™å°±æ˜¯ Flatpak åº”ç”¨çš„æ„å»ºç¯å¢ƒã€‚

* æƒé™å’Œæ²™ç®±: Portals æœºåˆ¶

Flatpak çš„æ²™ç®±é»˜è®¤æ˜¯ *æ‹’ç»ä¸€åˆ‡*ï¼Œåº”ç”¨éœ€è¦ *æ˜¾å¼å£°æ˜æƒé™*ã€‚

** æƒé™ç±»å‹

*** Filesystem Access

æ§åˆ¶åº”ç”¨å¯ä»¥è®¿é—®å“ªäº›ç›®å½•:

#+begin_example
--filesystem=host           # è®¿é—®æ•´ä¸ªå®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ (ä¸æ¨èï¼)
--filesystem=home           # è®¿é—® $HOME
--filesystem=~/Documents    # åªè®¿é—® ~/Documents
--filesystem=xdg-download   # XDG ä¸‹è½½ç›®å½•
--filesystem=/tmp           # è®¿é—® /tmp
--filesystem=host:ro        # åªè¯»è®¿é—®æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ
#+end_example

*** Device Access

#+begin_example
--device=dri                # è®¿é—® GPU (OpenGL/Vulkan)
--device=kvm                # è®¿é—® KVM (è™šæ‹ŸåŒ–)
--device=all                # è®¿é—®æ‰€æœ‰è®¾å¤‡
#+end_example

*** Socket Access

#+begin_example
--socket=x11                # X11 æ˜¾ç¤ºæœåŠ¡å™¨
--socket=wayland            # Wayland æ˜¾ç¤ºæœåŠ¡å™¨
--socket=pulseaudio         # éŸ³é¢‘
--socket=session-bus        # D-Bus session bus
--socket=system-bus         # D-Bus system bus (å±é™©ï¼)
#+end_example

*** Network

#+begin_example
--share=network             # è®¿é—®ç½‘ç»œ (é»˜è®¤å…è®¸)
--unshare=network           # ç¦æ­¢ç½‘ç»œ
#+end_example

*** å…¶ä»–

#+begin_example
--allow=bluetooth           # è“ç‰™
--allow=devel               # å…è®¸ ptrace (è°ƒè¯•)
--talk-name=org.freedesktop.secrets  # D-Bus é€šä¿¡
--own-name=org.example.MyApp         # æ‹¥æœ‰ D-Bus åç§°
#+end_example

** æŸ¥çœ‹åº”ç”¨çš„æƒé™

#+begin_src bash
$ flatpak info --show-permissions org.mozilla.firefox

[Context]
shared=network;ipc;
sockets=x11;wayland;pulseaudio;cups;
devices=dri;
filesystems=xdg-download:rw;

[Session Bus Policy]
org.freedesktop.Notifications=talk
org.freedesktop.ScreenSaver=talk

[System Bus Policy]
org.freedesktop.NetworkManager=talk
#+end_src

è§£è¯»:

- =shared=network=: å¯ä»¥è®¿é—®ç½‘ç»œ
- =sockets=x11;wayland=: å¯ä»¥æ˜¾ç¤º GUI (X11 æˆ– Wayland)
- =devices=dri=: å¯ä»¥è®¿é—® GPU (ç¡¬ä»¶åŠ é€Ÿ)
- =filesystems=xdg-download:rw=: å¯ä»¥è¯»å†™ä¸‹è½½ç›®å½•
- =org.freedesktop.Notifications=talk=: å¯ä»¥å‘é€æ¡Œé¢é€šçŸ¥

** Portals: å®‰å…¨çš„æ–‡ä»¶è®¿é—®

å³ä½¿åº”ç”¨æ²¡æœ‰ =--filesystem=home= æƒé™ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ *XDG Desktop Portal* è®©ç”¨æˆ· *ä¸»åŠ¨æˆæƒ* è®¿é—®æ–‡ä»¶ã€‚

*** å·¥ä½œæµç¨‹

1. åº”ç”¨è°ƒç”¨ Portal API è¯·æ±‚æ‰“å¼€æ–‡ä»¶
2. Portal å¼¹å‡ºæ–‡ä»¶é€‰æ‹©å™¨ (è¿è¡Œåœ¨æ²™ç®±å¤–)
3. ç”¨æˆ·é€‰æ‹©æ–‡ä»¶
4. Portal è¿”å›æ–‡ä»¶å¥æŸ„ç»™åº”ç”¨

åº”ç”¨åªèƒ½è®¿é—® *ç”¨æˆ·æ˜ç¡®é€‰æ‹©* çš„æ–‡ä»¶ï¼Œæ— æ³•éå†æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚

*** Portal ç¤ºä¾‹ (D-Bus è°ƒç”¨)

#+begin_src python
import dbus

bus = dbus.SessionBus()
portal = bus.get_object(
    'org.freedesktop.portal.Desktop',
    '/org/freedesktop/portal/desktop'
)

# è¯·æ±‚æ‰“å¼€æ–‡ä»¶
result = portal.OpenFile(
    '',  # parent_window
    'Open File',
    {'filters': [('Text Files', '*.txt')]}
)

# result åŒ…å«æ–‡ä»¶è·¯å¾„æˆ–å¥æŸ„
#+end_src

åº”ç”¨çœ‹åˆ°çš„æ˜¯ *ä¸´æ—¶è·¯å¾„*â€‹ï¼Œå¦‚ =/run/user/1000/doc/abc123/file.txt=ï¼Œè€ŒéçœŸå®è·¯å¾„ã€‚

*** å¸¸è§ Portal

| Portal                              | åŠŸèƒ½     |
|-------------------------------------+----------|
| =org.freedesktop.portal.FileChooser=  | æ–‡ä»¶é€‰æ‹©å™¨ |
| =org.freedesktop.portal.Screenshot=   | æˆªå›¾     |
| =org.freedesktop.portal.Notification= | é€šçŸ¥     |
| =org.freedesktop.portal.Camera=       | æ‘„åƒå¤´è®¿é—® |
| =org.freedesktop.portal.Location=     | åœ°ç†ä½ç½®  |
| =org.freedesktop.portal.Print=        | æ‰“å°     |

æŸ¥çœ‹ Portal æœåŠ¡:

#+begin_src bash
$ ps aux | grep xdg-desktop-portal
/usr/libexec/xdg-desktop-portal
/usr/libexec/xdg-desktop-portal-gtk  # GTK åç«¯
/usr/libexec/xdg-desktop-portal-wlr  # Wayland (wlroots) åç«¯
#+end_src

** è¿è¡Œæ—¶è¦†ç›–æƒé™

ç”¨æˆ·å¯ä»¥é€šè¿‡ =flatpak override= ä¿®æ”¹åº”ç”¨æƒé™:

#+begin_src bash
# å…è®¸ Firefox è®¿é—®æ•´ä¸ª HOME
$ flatpak override --user --filesystem=home org.mozilla.firefox

# ç¦æ­¢ç½‘ç»œ
$ flatpak override --user --unshare=network org.mozilla.firefox

# æŸ¥çœ‹è¦†ç›–
$ flatpak override --user --show org.mozilla.firefox

[Context]
filesystems=home;

# é‡ç½®è¦†ç›–
$ flatpak override --user --reset org.mozilla.firefox
#+end_src

*æ³¨æ„*: è¿‡åº¦æ”¾å®½æƒé™ä¼šç ´åæ²™ç®±ï¼

* å®é™…ä½¿ç”¨: å®‰è£…ã€è¿è¡Œã€ç®¡ç†

** æ·»åŠ  Flathub ä»“åº“

Flathub æ˜¯æœ€å¤§çš„ Flatpak åº”ç”¨å•†åº—:

#+begin_src bash
# ç³»ç»Ÿçº§ (æ‰€æœ‰ç”¨æˆ·)
$ sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

# ç”¨æˆ·çº§ (ä»…å½“å‰ç”¨æˆ·)
$ flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
#+end_src

æŸ¥çœ‹ä»“åº“:

#+begin_src bash
$ flatpak remotes
Name    Options
flathub system,oci
#+end_src

** æœç´¢å’Œå®‰è£…

#+begin_src bash
# æœç´¢
$ flatpak search firefox
Name        Description                     Application ID            Version Branch Remotes
Firefox     Web Browser                     org.mozilla.firefox       133.0   stable flathub

# å®‰è£…
$ flatpak install flathub org.mozilla.firefox

# å®‰è£…åˆ°ç”¨æˆ·ç›®å½• (ä¸éœ€è¦ sudo)
$ flatpak install --user flathub org.mozilla.firefox
#+end_src

** è¿è¡Œåº”ç”¨

#+begin_src bash
# è¿è¡Œ
$ flatpak run org.mozilla.firefox

# è¿è¡Œå¹¶ä¼ é€’å‚æ•°
$ flatpak run org.mozilla.firefox https://example.com

# è¿è¡ŒæŒ‡å®šå‘½ä»¤ (è°ƒè¯•ç”¨)
$ flatpak run --command=bash org.mozilla.firefox
#+end_src

** æŸ¥çœ‹å·²å®‰è£…åº”ç”¨

#+begin_src bash
$ flatpak list
Name                 Application ID                  Version  Branch Origin
Firefox              org.mozilla.firefox             133.0    stable flathub
Freedesktop Platform org.freedesktop.Platform        23.08    23.08  flathub
GNOME Platform       org.gnome.Platform              46       46     flathub

# åªçœ‹åº”ç”¨ (ä¸åŒ…æ‹¬ Runtime)
$ flatpak list --app
#+end_src

** æ›´æ–°

#+begin_src bash
# æ›´æ–°æ‰€æœ‰
$ flatpak update

# æ›´æ–°æŒ‡å®šåº”ç”¨
$ flatpak update org.mozilla.firefox

# æ£€æŸ¥å¯æ›´æ–°é¡¹
$ flatpak remote-ls --updates
#+end_src

** å¸è½½

#+begin_src bash
# å¸è½½åº”ç”¨
$ flatpak uninstall org.mozilla.firefox

# å¸è½½å¹¶åˆ é™¤ç”¨æˆ·æ•°æ®
$ flatpak uninstall --delete-data org.mozilla.firefox

# æ¸…ç†æœªä½¿ç”¨çš„ Runtime
$ flatpak uninstall --unused
#+end_src

** æŸ¥çœ‹åº”ç”¨ä¿¡æ¯

#+begin_src bash
$ flatpak info org.mozilla.firefox

Firefox - Web Browser

          ID: org.mozilla.firefox
         Ref: app/org.mozilla.firefox/x86_64/stable
        Arch: x86_64
      Branch: stable
     Version: 133.0
     License: MPL-2.0
      Origin: flathub
  Collection: org.flathub.Stable
Installation: system
   Installed: 308.5 MB
     Runtime: org.freedesktop.Platform/x86_64/23.08
         Sdk: org.freedesktop.Sdk/x86_64/23.08

      Commit: a1b2c3d4e5f6...
      Parent: 0f9e8d7c6b5a...
#+end_src

** è¿›å…¥åº”ç”¨çš„æ²™ç®±

#+begin_src bash
$ flatpak run --command=bash org.mozilla.firefox

# åœ¨æ²™ç®±å†…
[ğŸ“¦ org.mozilla.firefox ~]$ pwd
/var/home/sov710  # æ˜ å°„çš„ HOME

[ğŸ“¦ org.mozilla.firefox ~]$ ls -la
# è¿™æ˜¯ ~/.var/app/org.mozilla.firefox/ çš„å†…å®¹

[ğŸ“¦ org.mozilla.firefox ~]$ env | grep XDG
XDG_DATA_HOME=/var/home/sov710/.local/share
XDG_CONFIG_HOME=/var/home/sov710/.config
XDG_CACHE_HOME=/var/home/sov710/.cache
#+end_src

* è°ƒè¯•å’Œæ•…éšœæ’æŸ¥

** æŸ¥çœ‹åº”ç”¨çš„å®é™…å¯åŠ¨å‚æ•°

#+begin_src bash
$ flatpak run --command=sh org.mozilla.firefox -c 'cat /proc/$$/cmdline | tr "\0" "\n"'

/usr/bin/bwrap
--args
59
--ro-bind
/usr
/usr
...
#+end_src

æˆ–è€…:

#+begin_src bash
$ ps auxf | grep -A 20 bwrap
#+end_src

** å¯ç”¨è¯¦ç»†æ—¥å¿—

#+begin_src bash
$ FLATPAK_BWRAP_DEBUG=1 flatpak run org.mozilla.firefox
bwrap: New pidns 2345
bwrap: Mounting tmpfs on /tmp
bwrap: Bind mounting /usr (ro)
...
#+end_src

** æŸ¥çœ‹æ²™ç®±çš„æ–‡ä»¶ç³»ç»Ÿ

#+begin_src bash
$ flatpak run --command=bash org.mozilla.firefox
[ğŸ“¦ org.mozilla.firefox ~]$ mount | grep -v tmpfs

/dev/sda2 on /usr type ext4 (ro,relatime)
/dev/sda2 on /etc type ext4 (ro,relatime)
overlay on /app type overlay (rw,...)
#+end_src

** ä¸´æ—¶ç¦ç”¨æ²™ç®±

#+begin_src bash
# ç»™äºˆæ‰€æœ‰æƒé™ (å±é™©ï¼ä»…ç”¨äºè°ƒè¯•)
$ flatpak run --filesystem=host --device=all --socket=session-bus --socket=system-bus org.mozilla.firefox
#+end_src

** æ£€æŸ¥åº”ç”¨çš„ç§æœ‰æ•°æ®

Flatpak åº”ç”¨çš„æ•°æ®å­˜åœ¨:

#+begin_src bash
$ ls ~/.var/app/org.mozilla.firefox/
cache  config  data

$ du -sh ~/.var/app/org.mozilla.firefox/
1.2G    /home/sov710/.var/app/org.mozilla.firefox/
#+end_src

ç­‰ä»·äºæ²™ç®±å†…çš„ =$XDG_CACHE_HOME=, =$XDG_CONFIG_HOME=, =$XDG_DATA_HOME=ã€‚

** Portal è°ƒè¯•

æŸ¥çœ‹ Portal æ—¥å¿—:

#+begin_src bash
$ journalctl --user -u xdg-desktop-portal -f

Dec 29 12:34:56 hostname xdg-desktop-portal[1234]: OpenFile called by :1.234
Dec 29 12:34:58 hostname xdg-desktop-portal[1234]: File selected: /home/sov710/test.txt
#+end_src

æµ‹è¯• Portal æ˜¯å¦å·¥ä½œ:

#+begin_src bash
$ flatpak run --command=bash org.mozilla.firefox
[ğŸ“¦ org.mozilla.firefox ~]$ busctl --user call \
  org.freedesktop.portal.Desktop \
  /org/freedesktop/portal/desktop \
  org.freedesktop.portal.Screenshot \
  Screenshot "ssa{sv}" "" "" 0
#+end_src

** æ£€æŸ¥ OSTree ä»“åº“å¥åº·åº¦

#+begin_src bash
$ ostree fsck --repo=/var/lib/flatpak/repo

Validating refs...
Validating objects...
object 00/1234abcd... ok
...
#+end_src

** æ¸…ç†ç£ç›˜ç©ºé—´

#+begin_src bash
# æ¸…ç†æœªä½¿ç”¨çš„ Runtime
$ flatpak uninstall --unused

# æ¸…ç† OSTree ä»“åº“ä¸­çš„å­¤å„¿å¯¹è±¡
$ ostree prune --repo=/var/lib/flatpak/repo --depth=0

# æŸ¥çœ‹å ç”¨
$ flatpak list --app --columns=name,size
$ flatpak list --runtime --columns=name,size
#+end_src

** å¸¸è§é—®é¢˜

*** 1. åº”ç”¨æ— æ³•å¯åŠ¨ (ç¼ºå°‘ Portal)

#+begin_example
error: Failed to open portal: GDBus.Error:org.freedesktop.DBus.Error.ServiceUnknown
#+end_example

è§£å†³:

#+begin_src bash
$ sudo pacman -S xdg-desktop-portal xdg-desktop-portal-gtk  # Arch
$ sudo apt install xdg-desktop-portal xdg-desktop-portal-gtk  # Debian/Ubuntu
#+end_src

é‡å¯ Portal:

#+begin_src bash
$ systemctl --user restart xdg-desktop-portal
#+end_src

*** 2. GPU åŠ é€Ÿä¸å·¥ä½œ

æ£€æŸ¥æ˜¯å¦æœ‰ GL extension:

#+begin_src bash
$ flatpak list | grep GL
org.freedesktop.Platform.GL.default  # Mesa
org.freedesktop.Platform.GL.nvidia   # NVIDIA
#+end_src

å¦‚æœç¼ºå¤±:

#+begin_src bash
$ flatpak install flathub org.freedesktop.Platform.GL.default
#+end_src

éªŒè¯:

#+begin_src bash
$ flatpak run --command=glxinfo org.mozilla.firefox | grep "OpenGL renderer"
OpenGL renderer string: Mesa Intel(R) UHD Graphics
#+end_src

*** 3. ä¸­æ–‡è¾“å…¥æ³•ä¸å·¥ä½œ

Flatpak åº”ç”¨éœ€è¦è®¿é—®è¾“å…¥æ³•çš„ socket:

#+begin_src bash
$ flatpak override --user --filesystem=xdg-run/fcitx:ro org.mozilla.firefox
#+end_src

æˆ–è€…åœ¨åº”ç”¨çš„ manifest ä¸­æ·»åŠ :

#+begin_example
--filesystem=xdg-run/fcitx:ro
--env=GTK_IM_MODULE=fcitx
--env=QT_IM_MODULE=fcitx
--env=XMODIFIERS=@im=fcitx
#+end_example

*** 4. ä¸»é¢˜ä¸æ­£ç¡®

GTK ä¸»é¢˜:

#+begin_src bash
$ flatpak install flathub org.gtk.Gtk3theme.Adwaita-dark
$ flatpak override --user --env=GTK_THEME=Adwaita-dark org.mozilla.firefox
#+end_src

Qt ä¸»é¢˜:

#+begin_src bash
$ flatpak install flathub org.kde.KStyle.Adwaita
$ flatpak override --user --env=QT_STYLE_OVERRIDE=Adwaita org.kde.kcalc
#+end_src

*** 5. å­—ä½“ç¼ºå¤±

Flatpak åº”ç”¨ä½¿ç”¨ Runtime è‡ªå¸¦çš„å­—ä½“ï¼Œå¯èƒ½ç¼ºå°‘ä¸­æ–‡å­—ä½“ã€‚

ä¸´æ—¶æ–¹æ¡ˆ:

#+begin_src bash
$ flatpak override --user --filesystem=~/.local/share/fonts:ro org.mozilla.firefox
$ flatpak override --user --filesystem=/usr/share/fonts:ro org.mozilla.firefox
#+end_src

é•¿æœŸæ–¹æ¡ˆ: å®‰è£…å­—ä½“æ‰©å±•:

#+begin_src bash
$ flatpak install flathub org.freedesktop.Platform.Locale.zh_CN
#+end_src

* æ„å»ºè‡ªå·±çš„ Flatpak åº”ç”¨

** Flatpak Manifest

Flatpak åº”ç”¨é€šè¿‡ *manifest* æ–‡ä»¶æè¿°æ„å»ºè¿‡ç¨‹ï¼Œæ ¼å¼ä¸º JSON æˆ– YAMLã€‚

*** ç¤ºä¾‹: Hello World

#+begin_src yaml
# org.example.Hello.yml
app-id: org.example.Hello
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: hello

modules:
  - name: hello
    buildsystem: simple
    build-commands:
      - install -D hello.sh /app/bin/hello
    sources:
      - type: file
        path: hello.sh
#+end_src

#+begin_src bash
# hello.sh
#!/bin/bash
echo "Hello from Flatpak!"
#+end_src

*** æ„å»º

#+begin_src bash
$ flatpak-builder build-dir org.example.Hello.yml

$ flatpak-builder --user --install --force-clean build-dir org.example.Hello.yml

$ flatpak run org.example.Hello
Hello from Flatpak!
#+end_src

** å¸¸è§ Buildsystem

| Buildsystem | è¯´æ˜                |
|-------------+---------------------|
| =autotools=   | =./configure && make= |
| =cmake=       | CMake               |
| =meson=       | Meson               |
| =simple=      | è‡ªå®šä¹‰è„šæœ¬            |
| =qmake=       | Qt qmake            |

** ä¾èµ–å¤–éƒ¨åº“

#+begin_src yaml
modules:
  - name: libfoo
    sources:
      - type: archive
        url: https://example.com/libfoo-1.0.tar.gz
        sha256: abcd1234...

  - name: myapp
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/example/myapp.git
        tag: v1.0.0
#+end_src

** å‘å¸ƒåˆ° Flathub

1. Fork [[https://github.com/flathub/flathub]]
2. æäº¤ manifest æ–‡ä»¶ PR
3. ç­‰å¾…å®¡æ ¸
4. åˆå¹¶åè‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒ

* æ€§èƒ½å’Œèµ„æºå ç”¨

** å¯åŠ¨æ—¶é—´å¯¹æ¯”

å®æµ‹ (Intel i7-12700, NVMe SSD):

| åº”ç”¨              | åŸç”Ÿ (ms) | Flatpak (ms) | å·®å¼‚ |
|-------------------+-----------+--------------+------|
| Firefox           |       420 |          520 | +24% |
| GIMP              |      1200 |         1350 | +13% |
| VSCode (Electron) |       680 |          750 | +10% |

ä¸»è¦å¼€é”€:

- Bubblewrap å¯åŠ¨: ~30-50ms
- OSTree æŒ‚è½½: ~20-40ms
- Portal åˆå§‹åŒ–: ~10-20ms

** å†…å­˜å ç”¨

#+begin_src bash
$ ps aux | grep firefox
USER       PID %CPU %MEM    VSZ   RSS
sov710   12345  5.2  3.8 4567890 987654 # åŸç”Ÿ
sov710   23456  5.5  4.1 4789012 1098765 # Flatpak

# å·®å¼‚: +10% (ä¸»è¦æ˜¯ bwrap è¿›ç¨‹å’Œ OSTree å¼€é”€)
#+end_src

** ç£ç›˜å ç”¨å¯¹æ¯”

#+begin_example
åŸç”Ÿå®‰è£…:
Firefox: /usr/lib/firefox (250 MB)

Flatpak:
Runtime: org.freedesktop.Platform (500 MB, å¤šåº”ç”¨å…±äº«)
Firefox: /var/lib/flatpak/app/... (80 MB, åº”ç”¨æœ¬èº«)
æ€»è®¡: 580 MB (é¦–ä¸ªåº”ç”¨)
æ¯å¢åŠ ä¸€ä¸ªåº”ç”¨: +50-100 MB (å…±äº« Runtime)
#+end_example

å¦‚æœå®‰è£… 5 ä¸ªåº”ç”¨:

- åŸç”Ÿ: 5 Ã— 200 MB = 1000 MB
- Flatpak: 500 MB (Runtime) + 5 Ã— 80 MB = 900 MB

*ç»“è®º*: Flatpak åœ¨å¤šåº”ç”¨åœºæ™¯ä¸‹ *æ›´çœç©ºé—´* (Runtime å»é‡)ã€‚

* æ€»ç»“: Flatpak å€¼å¾—ç”¨å—ï¼Ÿ

** ä¼˜åŠ¿

1. *å‘è¡Œç‰ˆæ— å…³*: ä¸€æ¬¡æ‰“åŒ…ï¼Œåˆ°å¤„è¿è¡Œ
2. *æ²™ç®±å®‰å…¨*: é™åˆ¶åº”ç”¨æƒé™ï¼Œå‡å°‘æ”»å‡»é¢
3. *å¿«é€Ÿæ›´æ–°*: ç»•è¿‡å‘è¡Œç‰ˆæ‰“åŒ…æµç¨‹
4. *å»é‡èŠ‚çœç©ºé—´*: Runtime å…±äº«æœºåˆ¶
5. *åŸå­æ›´æ–°*: OSTree ä¿è¯ä¸€è‡´æ€§
6. *ç”¨æˆ·çº§å®‰è£…*: æ— éœ€ root

** åŠ£åŠ¿

1. *å¯åŠ¨ç•¥æ…¢*: +10-20% å»¶è¿Ÿ
2. *æ¡Œé¢é›†æˆé—®é¢˜*: ä¸»é¢˜ã€å­—ä½“ã€è¾“å…¥æ³•éœ€è¦é¢å¤–é…ç½®
3. *è°ƒè¯•å›°éš¾*: æ²™ç®±éš”ç¦»å¢åŠ å¤æ‚åº¦
4. *ç£ç›˜å ç”¨*: å•åº”ç”¨åœºæ™¯ä¸‹æ¯”åŸç”Ÿå¤§
5. *ç”Ÿæ€ç¢ç‰‡åŒ–*: ä¸ Snap, AppImage ç«äº‰

** é€‚ç”¨åœºæ™¯

*æ¨èä½¿ç”¨ Flatpak*:

- éœ€è¦æœ€æ–°ç‰ˆæœ¬çš„æ¡Œé¢åº”ç”¨ (å‘è¡Œç‰ˆä»“åº“å¤ªæ—§)
- é—­æºè½¯ä»¶ (Spotify, Discord, Slack)
- ä¸ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹åº”ç”¨ (éœ€è¦æ²™ç®±)
- è·¨å‘è¡Œç‰ˆå¼€å‘ (ä¸€æ¬¡æ„å»º)

*ä¸æ¨èä½¿ç”¨ Flatpak*:

- ç³»ç»Ÿçº§å·¥å…· (éœ€è¦å®Œæ•´ç³»ç»Ÿè®¿é—®)
- å‘½ä»¤è¡Œå·¥å…· (é›†æˆéº»çƒ¦)
- å¯¹å¯åŠ¨é€Ÿåº¦æ•æ„Ÿçš„åº”ç”¨
- åµŒå…¥å¼æˆ–æœåŠ¡å™¨ç¯å¢ƒ

** ä¸ªäººå»ºè®®

åœ¨ Gentoo ä¸Š:

- *ä¼˜å…ˆç”¨ Portage*: ç¼–è¯‘ä¼˜åŒ– + å®Œç¾é›†æˆ
- *æ¬¡é€‰ Flatpak*: é—­æºè½¯ä»¶ (Discord, Zoom) æˆ–éœ€è¦æœ€æ–°ç‰ˆ (Blender, GIMP)
- *é¿å… Snap*: Canonical çš„åƒåœ¾ç©æ„ï¼Œé—­æºåç«¯

åœ¨ Arch/Fedora/Ubuntu ä¸Š:

- *Flatpak æ˜¯å¥½é€‰æ‹©*: æ¯”å‘è¡Œç‰ˆä»“åº“æ›´æ–°ï¼Œæ¯” Snap å¼€æ”¾

*æœ€é‡è¦çš„*: ç†è§£ Flatpak çš„åŸç†å’Œé™åˆ¶ï¼Œåˆç†ä½¿ç”¨ï¼Œä¸è¦ç›²ç›®å¹æ§æˆ–æ’æ–¥ã€‚
