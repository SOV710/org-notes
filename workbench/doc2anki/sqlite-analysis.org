#+title: SQLite Database Analysis Report
#+author: SOV710
#+date: <2026-01-11 Sun>

* Database Information

| Property      | Value                  |
|---------------+------------------------|
| File Path     | collection.sqlite      |
| File Size     | 0.13 MB (135168 bytes) |
| Analysis Date | 2026-01-10 00:43:26    |

* Tables and Views Overview

| Name        | Type  | Row Count |
|-------------+-------+-----------|
| cards       | table |         1 |
| col         | table |         1 |
| config      | table |        16 |
| deck_config | table |         1 |
| decks       | table |       N/A |
| fields      | table |       N/A |
| graves      | table |         0 |
| notes       | table |         1 |
| notetypes   | table |         1 |
| revlog      | table |         0 |
| tags        | table |       N/A |
| templates   | table |         9 |

* Detailed Table Structures

** Table: =cards=

*** Schema

#+begin_src
CREATE TABLE cards (
  id integer PRIMARY KEY,
  // 唯一id，毫秒级时间戳

  nid integer NOT NULL,
  // 语义上的外键(但不是数据库结构中的外键), 指向 notes 所属的 note id

  did integer NOT NULL,
  // 伪外键, 指向所属 deck 的 id

  ord integer NOT NULL,
  // 来自 notetype 中第几个模板

  mod integer NOT NULL,
  // 最后修改时间，秒级时间戳

  usn integer NOT NULL,
  // 同步序号, -1 代表未同步, >=0 代表已同步

  type integer NOT NULL,
  // 代表卡片类型, 具体如下

  // | type | 含义       |
  // | ---- | ---------- |
  // | 0    | New        |
  // | 1    | Learning   |
  // | 2    | Review     |
  // | 3    | Relearning |

  queue integer NOT NULL,
  // 调度队列 (当前位置)


  // | queue | 含义         |
  // | ----- | ------------ |
  // | 0     | New          |
  // | 1     | Learning     |
  // | 2     | Review       |
  // | 3     | Day Learning |
  // | -1    | Suspended    |
  // | -2    | Buried       |

  due integer NOT NULL,
  // 到期时间 (核心字段)
  // 含义取决于 type/queue

  // | 状态     | due 的意义                 |
  // | -------- | ------------------------ |
  // | New      | 新卡位置序号               |
  // | Learning | Unix 时间戳 (分钟)         |
  // | Review   | 天数 (collection 创建日起) |

  ivl integer NOT NULL,
  // 间隔 (interval)
  // 上一次复习到下一次复习的天数
  // 新卡一定是 0

  factor integer NOT NULL,
  // Ease Factor (×1000)
  // 熟悉度因子, 新卡为 0
  // Review 卡通常 ~2500 (即 2.5)

  reps integer NOT NULL,
  // 复习次数, 被回答过多少次 (不含预览)

  lapses integer NOT NULL,
  // 遗忘次数, review 状态下答错的次数

  left integer NOT NULL,
  // Learning / Relearning 阶段剩余学习步数
  // New card 时无意义, 为 0

  odue integer NOT NULL,
  // 原 due, 被拉入 filtered deck 前的 due
  // 不在 filtered deck 中时为 0

  odid integer NOT NULL,
  // 原 deck ID, 原本所在的 deck
  // filtered deck 用, 非 filtered deck 时为 0

  flags integer NOT NULL,
  // 用户手动打的 flag, u8 位掩码, New Card 为 0

  data text NOT NULL
  // 拓展 JSON, New Card 为 "{}"
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK          |
| nid         | INTEGER | NOT NULL    |
| did         | INTEGER | NOT NULL    |
| ord         | INTEGER | NOT NULL    |
| mod         | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| type        | INTEGER | NOT NULL    |
| queue       | INTEGER | NOT NULL    |
| due         | INTEGER | NOT NULL    |
| ivl         | INTEGER | NOT NULL    |
| factor      | INTEGER | NOT NULL    |
| reps        | INTEGER | NOT NULL    |
| lapses      | INTEGER | NOT NULL    |
| left        | INTEGER | NOT NULL    |
| odue        | INTEGER | NOT NULL    |
| odid        | INTEGER | NOT NULL    |
| flags       | INTEGER | NOT NULL    |
| data        | TEXT    | NOT NULL    |

*** Indexes

- *idx_cards_odid*: (odid)
- *ix_cards_sched*: (did, queue, due)
- *ix_cards_nid*: (nid)
- *ix_cards_usn*: (usn)

### Table: =col=

*** Schema

#+begin_src
CREATE TABLE col (
  id integer PRIMARY KEY,
  // 唯一主键, 固定为 1, 单行表

  crt integer NOT NULL,
  // collection 创建时间, 秒级时间戳

  mod integer NOT NULL,
  // 最后修改时间, 毫秒级时间戳

  scm integer NOT NULL,
  // schema 修改时间, 毫秒级时间戳

  ver integer NOT NULL,
  // collection schema 版本，当前最新版本为 v18
  // 旧版, 也就是目前 genanki 在支持的那一版, 为 v11

  dty integer NOT NULL,
  // dirty flag: 标记 collection 是否处于"脏"状态 (存在未妥善提交/未同步的变更)
  // 实务上: 0 表示"干净"；非 0 表示"有未同步/未整理的变更"

  usn integer NOT NULL,
  // 同步序号, -1 为未同步, 在一般 collection 里为 0

  ls integer NOT NULL,
  // 记录上次同步相关状态
  // 一般为 0

  conf text NOT NULL,
  models text NOT NULL,
  decks text NOT NULL,
  dconf text NOT NULL,
  tags text NOT NULL
  // 均为 deprecated, 在 v18 schema 中仅为了兼容性保留, 应当置空
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK          |
| crt         | INTEGER | NOT NULL    |
| mod         | INTEGER | NOT NULL    |
| scm         | INTEGER | NOT NULL    |
| ver         | INTEGER | NOT NULL    |
| dty         | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| ls          | INTEGER | NOT NULL    |
| conf        | TEXT    | NOT NULL    |
| models      | TEXT    | NOT NULL    |
| decks       | TEXT    | NOT NULL    |
| dconf       | TEXT    | NOT NULL    |
| tags        | TEXT    | NOT NULL    |

* Table: =config=

*** Schema

#+begin_src
CREATE TABLE config (
  KEY text NOT NULL PRIMARY KEY,
  // 配置项的名字, 字符串主键

  usn integer NOT NULL,
  // -1/0, -1 未同步, 新 deck 最好都设置为 -1

  mtime_secs integer NOT NULL,
  // 修改时间, 秒级时间戳

  val blob NOT NULL
  // 值, BLOB, 实际上是序列化后的 JSON, 或者类似于 json 的编码格式

) without rowid
#+end_src

#+begin_src
sqlite> SELECT * FROM config;
activeDecks|0|0|[1]
addToCur|0|0|true
collapseTime|0|0|1200
creationOffset|0|0|-480
curDeck|0|0|1
curModel|-1|1767897451|1767897451168
dayLearnFirst|0|0|false
dueCounts|0|0|true
estTimes|0|0|true
newSpread|0|0|0
nextPos|0|0|1
sched2021|0|0|true
schedVer|0|0|2
sortBackwards|0|0|false
sortType|0|0|"noteFld"
timeLim|0|0|0
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| KEY         | TEXT    | PK NOT NULL |
| usn         | INTEGER | NOT NULL    |
| mtime_secs  | INTEGER | NOT NULL    |
| val         | BLOB    | NOT NULL    |

*** Indexes

- *sqlite_autoindex_config_1*: (KEY) UNIQUE

* Table: =deck_config=

*** Schema

#+begin_src
CREATE TABLE deck_config (
  id integer PRIMARY KEY NOT NULL,

  name text NOT NULL COLLATE unicase,

  mtime_secs integer NOT NULL,

  usn integer NOT NULL,

  config blob NOT NULL
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK NOT NULL |
| name        | TEXT    | NOT NULL    |
| mtime_secs  | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| config      | BLOB    | NOT NULL    |

* Table: =decks=

*** Schema

#+begin_src
CREATE TABLE decks (
  id integer PRIMARY KEY NOT NULL,
  // 全局唯一的 deck 主键标识, 被 cards 的 did 引用, 使用毫秒级时间戳

  name text NOT NULL COLLATE unicase,
  // 人类可读的 deck 名

  mtime_secs integer NOT NULL,
  // 修改时间 (秒级)

  usn integer NOT NULL,
  // -1

  common blob NOT NULL,
  // 傻逼

  kind blob NOT NULL
  // 傻逼
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK NOT NULL |
| name        | TEXT    | NOT NULL    |
| mtime_secs  | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| common      | BLOB    | NOT NULL    |
| kind        | BLOB    | NOT NULL    |

*** Indexes

- *idx_decks_name*: (name) UNIQUE

* Blob: ==

* Table: =fields=

*** Schema

#+begin_src
CREATE TABLE fields (
  ntid integer NOT NULL,

  ord integer NOT NULL,

  name text NOT NULL COLLATE unicase,

  config blob NOT NULL,

  PRIMARY KEY (ntid, ord)
) without rowid
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| ntid        | INTEGER | PK NOT NULL |
| ord         | INTEGER | PK NOT NULL |
| name        | TEXT    | NOT NULL    |
| config      | BLOB    | NOT NULL    |

*** Indexes

- *idx_fields_name_ntid*: (name, ntid) UNIQUE
- *sqlite_autoindex_fields_1*: (ntid, ord) UNIQUE

* Table: =graves=

*** Schema

#+begin_src
CREATE TABLE graves (
  oid integer NOT NULL,

  type integer NOT NULL,

  usn integer NOT NULL,

  PRIMARY KEY (oid, type)
) WITHOUT ROWID
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| oid         | INTEGER | PK NOT NULL |
| type        | INTEGER | PK NOT NULL |
| usn         | INTEGER | NOT NULL    |

*** Indexes

- *idx_graves_pending*: (usn)
- *sqlite_autoindex_graves_1*: (oid, type) UNIQUE

* Table: =notes=

*** Schema

#+begin_src
CREATE TABLE notes (
  id integer PRIMARY KEY,
  -- 主键, 毫秒级时间戳

  guid text NOT NULL,
  -- 伪随机 base91

  mid integer NOT NULL,
  -- notetype id, 外键到 notetypes 这张表

  mod integer NOT NULL,
  -- 秒级时间戳

  usn integer NOT NULL,
  -- 新卡统一 -1

  tags text NOT NULL,
  -- 空格分隔的 tag 列表, 前后通常都有空格

  flds text NOT NULL,
  -- 字段内容拼接字符串, 使用 Unit Separator (\x1f) 分隔

  -- The use of type integer for sfld is deliberate, because it means that integer values in this
  -- field will sort numerically.
  sfld integer NOT NULL,
  -- 排序字段, 目前不知道拆的哪个表

  csum integer NOT NULL,
  -- sha1sum 校验段

  flags integer NOT NULL,
  -- 不知道是干嘛的, 大多数时候是 0

  data text NOT NULL
  -- 拓展字段, 大多数时候为空, ""
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK          |
| guid        | TEXT    | NOT NULL    |
| mid         | INTEGER | NOT NULL    |
| mod         | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| tags        | TEXT    | NOT NULL    |
| flds        | TEXT    | NOT NULL    |
| sfld        | INTEGER | NOT NULL    |
| csum        | INTEGER | NOT NULL    |
| flags       | INTEGER | NOT NULL    |
| data        | TEXT    | NOT NULL    |

*** Indexes

- *idx_notes_mid*: (mid)
- *ix_notes_csum*: (csum)
- *ix_notes_usn*: (usn)

* Table: =notetypes=

*** Schema

#+begin_src
CREATE TABLE notetypes (
  id integer NOT NULL PRIMARY KEY,
  -- 毫秒级时间戳, 即刻创建即可

  name text NOT NULL COLLATE unicase,
  -- notetype 的展示名

  mtime_secs integer NOT NULL,
  -- notetype 的最后修改时间, 秒级时间戳

  usn integer NOT NULL,
  -- 同步, -1 即可

  config blob NOT NULL
  -- 见下
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK NOT NULL |
| name        | TEXT    | NOT NULL    |
| mtime_secs  | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| config      | BLOB    | NOT NULL    |

*** Indexes

- *idx_notetypes_usn*: (usn)
- *idx_notetypes_name*: (name) UNIQUE

* Blob: =notetypes.config=

*** Prototype

#+begin_src
message Config {
  enum Kind {
    KIND_NORMAL = 0;
    KIND_CLOZE = 1;
  }
  message CardRequirement {
    enum Kind {
      KIND_NONE = 0;
      // 不做条件检查（无条件生成）

      KIND_ANY = 1;
      // field_ords 中 任意一个字段非空即可

      KIND_ALL = 2;
      // field_ords 中 所有字段都必须非空
    }
    uint32 card_ord = 1;
    // cards 的序号, 0-based 排序
    // 当 card_ord 为空时, 默认为 0

    Kind kind = 2;
    // field_ords 的内容怎么决定 cards 的生成

    repeated uint32 field_ords = 3;
    // 哪些字段参与"是否生成这张卡"的判断？
    // 序号是 0-based 的, 0 表示第一个字段
    // 顺序没有任何意义, 比如 basic 的 notetype 中, field_ords = [0, 1]
  }

  Kind kind = 1;
  uint32 sort_field_idx = 2;
  // 1

  string css = 3;
  // 放 css 的

  // This is now stored separately; retrieve with DefaultsForAdding()
  int64 target_deck_id_unused = 4;
  // 兼容性字段, 实际储存 ms epoch 时间戳

  string latex_pre = 5;
  // 存储 latex 的文件头

  string latex_post = 6;
  // 存储 latex 渲染的文件尾, 比如 "\\end{document}"

  bool latex_svg = 7;
  // 决定使用 dvipng 还是 dvisvgm 路线渲染, 如果 dvipng 则 0, dvisvgm 则 1

  repeated CardRequirement reqs = 8;
  // "某一张卡片是否应当被生成（created / shown）的条件规则集合
  // 每一条 CardRequirement 都是在说; 第 card_ord 张卡, 要求哪些字段 (field_ords) 满足何种存在性条件 (ANY / ALL / NONE), 否则该卡不会被创建

  // Only set on notetypes created with Anki 2.1.62+.
  StockNotetype.OriginalStockKind original_stock_kind = 9;

  // the id in the source collection for imported notetypes (Anki 23.10)
  optional int64 original_id = 10;
  // 标识原始来源 notetype 的 ID
  // 未设置 → "这是一个本地新建的 notetype, 没有历史来源"
  // 已设置 → "这是从别的 collection / 安装包导入的 notetype, 它在源 collection 中的 ID 是这个"

  bytes other = 255;
  // 兜底拓展字段, 容灾需要, 不需要在意
}
#+end_src

* Table: =revlog=

*** Schema

#+begin_src
CREATE TABLE revlog (
  id integer PRIMARY KEY,

  cid integer NOT NULL,

  usn integer NOT NULL,

  ease integer NOT NULL,

  ivl integer NOT NULL,

  lastIvl integer NOT NULL,

  factor integer NOT NULL,

  time integer NOT NULL,

  type integer NOT NULL
)
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| id          | INTEGER | PK          |
| cid         | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| ease        | INTEGER | NOT NULL    |
| ivl         | INTEGER | NOT NULL    |
| lastIvl     | INTEGER | NOT NULL    |
| factor      | INTEGER | NOT NULL    |
| time        | INTEGER | NOT NULL    |
| type        | INTEGER | NOT NULL    |

*** Indexes

- *ix_revlog_cid*: (cid)
- *ix_revlog_usn*: (usn)

** Table: =tags=

*** Schema

#+begin_src
CREATE TABLE tags (
  tag text NOT NULL PRIMARY KEY COLLATE unicase,

  usn integer NOT NULL,

  collapsed boolean NOT NULL,

  config blob NULL

) without rowid
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| tag         | TEXT    | PK NOT NULL |
| usn         | INTEGER | NOT NULL    |
| collapsed   | boolean | NOT NULL    |
| config      | BLOB    | -           |

*** Indexes

- *sqlite_autoindex_tags_1*: (tag) UNIQUE

* Table: =templates=

*** Schema

#+begin_src
CREATE TABLE templates (
  ntid integer NOT NULL,

  ord integer NOT NULL,

  name text NOT NULL COLLATE unicase,

  mtime_secs integer NOT NULL,

  usn integer NOT NULL,

  config blob NOT NULL,

  PRIMARY KEY (ntid, ord)

) without rowid
#+end_src

*** Columns

| Column Name | Type    | Constraints |
|-------------+---------+-------------|
| ntid        | INTEGER | PK NOT NULL |
| ord         | INTEGER | PK NOT NULL |
| name        | TEXT    | NOT NULL    |
| mtime_secs  | INTEGER | NOT NULL    |
| usn         | INTEGER | NOT NULL    |
| config      | BLOB    | NOT NULL    |

*** Indexes

- *idx_templates_usn*: (usn)
- *idx_templates_name_ntid*: (name, ntid) UNIQUE
- *sqlite_autoindex_templates_1*: (ntid, ord) UNIQUE
